---
# Alpha â€“ Anny Hua
# Service: Windows DNS Server
- name: Install DNS Server role
  ansible.windows.win_feature:
    name: DNS
    state: present
    include_management_tools: true

- name: Ensure DNS service is running and enabled
  ansible.windows.win_service:
    name: DNS
    start_mode: auto
    state: started

# --- Forward zone: inscope.local ---
# Try the Ansible module first; explicitly set legacy replication to avoid ReplicationScope=None error.
- name: Create forward lookup zone for inscope.local (module)
  ansible.windows.win_dns_zone:
    name: "inscope.local"
    type: primary
    state: present

# --- Host record(s) ---
- name: Ensure canterlot A record exists
  ansible.windows.win_dns_record:
    zone: "inscope.local"
    name: "canterlot"
    type: "A"
    value: "10.0.10.1"
    state: present

# # --- Reverse zones for your /24 networks ---
# - name: Create reverse lookup zone for 10.0.10.0/24 (core)
#   ansible.windows.win_dns_zone:
#     name: "10.0.10.in-addr.arpa"
#     type: primary
#     is_reverse_lookup_zone: true
#     state: present

# - name: Create reverse lookup zone for 10.0.20.0/24 (dmz)
#   ansible.windows.win_dns_zone:
#     name: "20.0.10.in-addr.arpa"
#     type: primary
#     is_reverse_lookup_zone: true
#     state: present

# - name: Create reverse lookup zone for 10.0.30.0/24 (internal)
#   ansible.windows.win_dns_zone:
#     name: "30.0.10.in-addr.arpa"
#     type: primary
#     is_reverse_lookup_zone: true
#     state: present

# # --- PTR record(s) ---
# - name: Create PTR record for canterlot (10.0.10.1)
#   ansible.windows.win_dns_record:
#     zone: "10.0.10.in-addr.arpa"
#     name: "1"
#     type: "PTR"
#     value: "canterlot.inscope.local"
#     state: present
